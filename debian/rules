#!/usr/bin/make -f

# Stolen from cdbs, we need this.
DEB_VERSION := $(shell dpkg-parsechangelog | egrep '^Version:' | cut -f 2 -d ' ')
DEB_NOEPOCH_VERSION := $(shell echo $(DEB_VERSION) | cut -d: -f2-)
DEB_UPSTREAM_VERSION := $(shell echo $(DEB_NOEPOCH_VERSION) | sed 's/-[^-]*$$//')

# Used during building to set the version
export CFLAGS=-DVERSION=\"$(DEB_UPSTREAM_VERSION)\"

%:
	dh $@ --buildsystem=python_distutils --with=python2

override_dh_install:
	dh_install --list-missing

override_dh_auto_build:
	dh_auto_build

override_dh_auto_install:
	dh_auto_install
	mkdir -p $(CURDIR)/debian/tmp/usr/lib/python2.7/dist-packages/pulse_pkgs_agent
	cp pkgs_agent/__init__.py $(CURDIR)/debian/tmp/usr/lib/python2.7/dist-packages/pulse_pkgs_agent
	cp -fr pkgs_agent/lib $(CURDIR)/debian/tmp/usr/lib/python2.7/dist-packages/pulse_pkgs_agent
	mkdir -p $(CURDIR)/debian/tmp/usr/sbin/
	cp pkgs_agent/bin/pulse_agent_xmlrpc_pkgs.py $(CURDIR)/debian/tmp/usr/sbin/
	mkdir -p $(CURDIR)/debian/tmp/usr/share/pkgs
	cp -fr ./pkgs_agent/web/* $(CURDIR)/debian/tmp/usr/share/pkgs
